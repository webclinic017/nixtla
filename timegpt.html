<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Unlock the power of accurate predictions and confidently navigate uncertainty. Reduce uncertainty and resource limitations. With TimeGPT, you can effortlessly access state-of-the-art models to make data-driven decisions. Whether you‚Äôre a bank forecasting market trends or a startup predicting product demand, TimeGPT democratizes access to cutting-edge predictive insights, eliminating the need for a dedicated team of machine learning engineers.">

<title>nixtlats - TimeGPT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon_png.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="nixtlats - TimeGPT">
<meta property="og:description" content="Unlock the power of accurate predictions and confidently navigate uncertainty. Reduce uncertainty and resource limitations. With TimeGPT, you can effortlessly access state-of-the-art models to make data-driven decisions. Whether you‚Äôre a bank forecasting market trends or a startup predicting product demand, TimeGPT democratizes access to cutting-edge predictive insights, eliminating the need for a dedicated team of machine learning engineers.">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="nixtlats">
<meta name="twitter:title" content="nixtlats - TimeGPT">
<meta name="twitter:description" content="Unlock the power of accurate predictions and confidently navigate uncertainty. Reduce uncertainty and resource limitations. With TimeGPT, you can effortlessly access state-of-the-art models to make data-driven decisions. Whether you‚Äôre a bank forecasting market trends or a startup predicting product demand, TimeGPT democratizes access to cutting-edge predictive insights, eliminating the need for a dedicated team of machine learning engineers.">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">nixtlats</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./timegpt.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast" rel="" target="">
 <span class="dropdown-text">MLForecast ü§ñ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/nixtlats" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./timegpt.html">SDK</a></li><li class="breadcrumb-item"><a href="./timegpt.html">TimeGPT</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NixtlaTS</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">SDK</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timegpt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">TimeGPT</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">Usage</a>
  <ul class="collapse">
  <li><a href="#timegpt" id="toc-timegpt" class="nav-link" data-scroll-target="#timegpt">TimeGPT</a></li>
  <li><a href="#forecast" id="toc-forecast" class="nav-link" data-scroll-target="#forecast">Forecast</a></li>
  <li><a href="#anomaly-detection" id="toc-anomaly-detection" class="nav-link" data-scroll-target="#anomaly-detection">Anomaly Detection</a></li>
  <li><a href="#historical-forecast" id="toc-historical-forecast" class="nav-link" data-scroll-target="#historical-forecast">Historical forecast</a></li>
  <li><a href="#prediction-intervals" id="toc-prediction-intervals" class="nav-link" data-scroll-target="#prediction-intervals">Prediction Intervals</a></li>
  <li><a href="#finetuning" id="toc-finetuning" class="nav-link" data-scroll-target="#finetuning">Finetuning</a></li>
  <li><a href="#multiple-series" id="toc-multiple-series" class="nav-link" data-scroll-target="#multiple-series">Multiple Series</a></li>
  <li><a href="#exogenous-variables" id="toc-exogenous-variables" class="nav-link" data-scroll-target="#exogenous-variables">Exogenous variables</a></li>
  <li><a href="#forecasting-time-series-with-irregular-timestamps" id="toc-forecasting-time-series-with-irregular-timestamps" class="nav-link" data-scroll-target="#forecasting-time-series-with-irregular-timestamps">Forecasting Time Series with Irregular Timestamps</a></li>
  <li><a href="#calendar-variables" id="toc-calendar-variables" class="nav-link" data-scroll-target="#calendar-variables">Calendar variables</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/nixtla/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TimeGPT</h1>
</div>

<div>
  <div class="description">
    Unlock the power of accurate predictions and confidently navigate uncertainty. Reduce uncertainty and resource limitations. With TimeGPT, you can effortlessly access state-of-the-art models to make data-driven decisions. Whether you‚Äôre a bank forecasting market trends or a startup predicting product demand, TimeGPT democratizes access to cutting-edge predictive insights, eliminating the need for a dedicated team of machine learning engineers.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Nixtla‚Äôs TimeGPT is a generative pre-trained model trained to forecast time series data. The inputs to TimeGPT are time series data, and the model generates forecast outputs based on these. The input involves providing the historical data and potentially defining parameters such as the forecast horizon. TimeGPT can be used across a plethora of tasks including demand forecasting, anomaly detection, financial forecasting, and more.</p>
<p>The TimeGPT model ‚Äúreads‚Äù time series data much like the way humans read a sentence ‚Äì from left to right. It looks at a chunk of past data, which we can think of as ‚Äútokens‚Äù, and predicts what comes next. This prediction is based on patterns the model identifies in past data, much like how a human would predict the end of a sentence based on the beginning.</p>
<p>The TimeGPT API provides an interface to this powerful model, allowing users to leverage its forecasting capabilities to predict future events based on past data. With this API, users can not only forecast future events but also delve into various time series-related tasks, such as what-if scenarios, anomaly detection, and more.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/timegpt-arch.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">figure</figcaption>
</figure>
</div>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<hr>
<section id="timegpt" class="level3">
<h3 class="anchored" data-anchor-id="timegpt">TimeGPT</h3>
<blockquote class="blockquote">
<pre><code> TimeGPT (token:str, environment:Optional[str]=None)</code></pre>
</blockquote>
<p>Constructs all the necessary attributes for the TimeGPT object.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>token</td>
<td>str</td>
<td></td>
<td>The authorization token to interact with the TimeGPT API.</td>
</tr>
<tr class="even">
<td>environment</td>
<td>Optional</td>
<td>None</td>
<td>Custom environment. Pass only if provided.</td>
</tr>
</tbody>
</table>
<p>You can instantiate the <code>TimeGPT</code> class providing your credentials.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>timegpt <span class="op">=</span> TimeGPT(token<span class="op">=</span>os.environ[<span class="st">'TIMEGPT_TOKEN'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can test the validate of your token calling the <code>validate_token</code> method:</p>
<hr>
<section id="timegpt.validate_token" class="level4">
<h4 class="anchored" data-anchor-id="timegpt.validate_token">TimeGPT.validate_token</h4>
<blockquote class="blockquote">
<pre><code> TimeGPT.validate_token (log:bool=True)</code></pre>
</blockquote>
<p>Returns True if your token is valid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>timegpt.validate_token()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Happy Forecasting! :), If you have questions or need support, please email ops@nixtla.io</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
</section>
</section>
<section id="forecast" class="level3">
<h3 class="anchored" data-anchor-id="forecast">Forecast</h3>
<hr>
<section id="timegpt.forecast" class="level4">
<h4 class="anchored" data-anchor-id="timegpt.forecast">TimeGPT.forecast</h4>
<blockquote class="blockquote">
<pre><code> TimeGPT.forecast (df:pandas.core.frame.DataFrame, h:int,
                   freq:Optional[str]=None, id_col:str='unique_id',
                   time_col:str='ds', target_col:str='y',
                   X_df:Optional[pandas.core.frame.DataFrame]=None,
                   level:Optional[List[Union[int,float]]]=None,
                   finetune_steps:int=0, clean_ex_first:bool=True,
                   validate_token:bool=False, add_history:bool=False,
                   date_features:Union[bool,List[str]]=False,
                   date_features_to_one_hot:Union[bool,List[str]]=True,
                   num_partitions:Optional[int]=None)</code></pre>
</blockquote>
<p>Forecast your time series using TimeGPT.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>DataFrame</td>
<td></td>
<td>The DataFrame on which the function will operate. Expected to contain at least the following columns:<br>- time_col:<br> Column name in <code>df</code> that contains the time indices of the time series. This is typically a datetime<br> column with regular intervals, e.g., hourly, daily, monthly data points.<br>- target_col:<br> Column name in <code>df</code> that contains the target variable of the time series, i.e., the variable we <br> wish to predict or analyze.<br>Additionally, you can pass multiple time series (stacked in the dataframe) considering an additional column:<br>- id_col:<br> Column name in <code>df</code> that identifies unique time series. Each unique value in this column<br> corresponds to a unique time series.</td>
</tr>
<tr class="even">
<td>h</td>
<td>int</td>
<td></td>
<td>Forecast horizon.</td>
</tr>
<tr class="odd">
<td>freq</td>
<td>Optional</td>
<td>None</td>
<td>Frequency of the data. By default, the freq will be inferred automatically.<br>See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas‚Äô available frequencies</a>.</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td>unique_id</td>
<td>Column that identifies each serie.</td>
</tr>
<tr class="odd">
<td>time_col</td>
<td>str</td>
<td>ds</td>
<td>Column that identifies each timestep, its values can be timestamps or integers.</td>
</tr>
<tr class="even">
<td>target_col</td>
<td>str</td>
<td>y</td>
<td>Column that contains the target.</td>
</tr>
<tr class="odd">
<td>X_df</td>
<td>Optional</td>
<td>None</td>
<td>DataFrame with [<code>unique_id</code>, <code>ds</code>] columns and <code>df</code>‚Äôs future exogenous.</td>
</tr>
<tr class="even">
<td>level</td>
<td>Optional</td>
<td>None</td>
<td>Confidence levels between 0 and 100 for prediction intervals.</td>
</tr>
<tr class="odd">
<td>finetune_steps</td>
<td>int</td>
<td>0</td>
<td>Number of steps used to finetune TimeGPT in the<br>new data.</td>
</tr>
<tr class="even">
<td>clean_ex_first</td>
<td>bool</td>
<td>True</td>
<td>Clean exogenous signal before making forecasts<br>using TimeGPT.</td>
</tr>
<tr class="odd">
<td>validate_token</td>
<td>bool</td>
<td>False</td>
<td>If True, validates token before <br>sending requests.</td>
</tr>
<tr class="even">
<td>add_history</td>
<td>bool</td>
<td>False</td>
<td>Return fitted values of the model.</td>
</tr>
<tr class="odd">
<td>date_features</td>
<td>Union</td>
<td>False</td>
<td>Features computed from the dates. <br>Can be pandas date attributes or functions that will take the dates as input.<br>If True automatically adds most used date features for the <br>frequency of <code>df</code>.</td>
</tr>
<tr class="even">
<td>date_features_to_one_hot</td>
<td>Union</td>
<td>True</td>
<td>Apply one-hot encoding to these date features.<br>If <code>date_features=True</code>, then all date features are<br>one-hot encoded by default.</td>
</tr>
<tr class="odd">
<td>num_partitions</td>
<td>Optional</td>
<td>None</td>
<td>Number of partitions to use.<br>Only used in distributed environments (spark, ray, dask).<br>If None, the number of partitions will be equal<br>to the available parallel resources.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>pandas.DataFrame</strong></td>
<td></td>
<td><strong>DataFrame with TimeGPT forecasts for point predictions and probabilistic<br>predictions (if level is not None).</strong></td>
</tr>
</tbody>
</table>
<p>Now you can start to make forecasts! Let‚Äôs import an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/Nixtla/transfer-learning-time-series/main/datasets/air_passengers.csv'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1949-01-01</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1949-02-01</td>
<td>118</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1949-03-01</td>
<td>132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1949-04-01</td>
<td>129</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1949-05-01</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let‚Äôs plot this series</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Now we can forecast this dataset. We observe that this dataset has monthly frequency. We have to pass the right pandas frequency to <code>TimeGPT</code> to have the right forecasts. In this case ‚ÄòMS‚Äô. Let‚Äôs forecast the next 12 observations. In this case we also have to define:</p>
<ul>
<li><code>time_col</code>: Column that identifies the datestamp column.</li>
<li><code>target_col</code>: The variable that we want to forecast.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">12</span>, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1961-01-01</td>
<td>437.837921</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-02-01</td>
<td>426.062714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1961-03-01</td>
<td>463.116547</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1961-04-01</td>
<td>478.244507</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1961-05-01</td>
<td>505.646484</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, timegpt_fcst_df]).set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>You can also produce a larger forecast horizon:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">36</span>, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1961-01-01</td>
<td>437.837921</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-02-01</td>
<td>426.062714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1961-03-01</td>
<td>463.116547</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1961-04-01</td>
<td>478.244507</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1961-05-01</td>
<td>505.646484</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, timegpt_fcst_df]).set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Or a shorter one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">6</span>, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pd.concat([df, timegpt_fcst_df]).set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-13-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="anomaly-detection" class="level3">
<h3 class="anchored" data-anchor-id="anomaly-detection">Anomaly Detection</h3>
<p>Anomaly detection in time series data plays a pivotal role in numerous sectors including finance, healthcare, security, and infrastructure. In essence, time series data represents a sequence of data points indexed (or listed or graphed) in time order, often with equal intervals. As systems and processes become increasingly digitized and interconnected, the need to monitor and ensure their normal behavior grows proportionally. Detecting anomalies can indicate potential problems, malfunctions, or even malicious activities. By promptly identifying these deviations from the expected pattern, organizations can take preemptive measures, optimize processes, or protect resources. <code>TimeGPT</code> includes the <code>detect_anomalies</code> method to detect anomalies automatically.</p>
<hr>
<section id="timegpt.detect_anomalies" class="level4">
<h4 class="anchored" data-anchor-id="timegpt.detect_anomalies">TimeGPT.detect_anomalies</h4>
<blockquote class="blockquote">
<pre><code> TimeGPT.detect_anomalies (df:pandas.core.frame.DataFrame,
                           freq:Optional[str]=None,
                           id_col:str='unique_id', time_col:str='ds',
                           target_col:str='y', level:Union[int,float]=99,
                           validate_token:bool=False)</code></pre>
</blockquote>
<p>Detect anomalies in your time series using TimeGPT.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>DataFrame</td>
<td></td>
<td>The DataFrame on which the function will operate. Expected to contain at least the following columns:<br>- time_col:<br> Column name in <code>df</code> that contains the time indices of the time series. This is typically a datetime<br> column with regular intervals, e.g., hourly, daily, monthly data points.<br>- target_col:<br> Column name in <code>df</code> that contains the target variable of the time series, i.e., the variable we <br> wish to predict or analyze.<br>Additionally, you can pass multiple time series (stacked in the dataframe) considering an additional column:<br>- id_col:<br> Column name in <code>df</code> that identifies unique time series. Each unique value in this column<br> corresponds to a unique time series.</td>
</tr>
<tr class="even">
<td>freq</td>
<td>Optional</td>
<td>None</td>
<td>Frequency of the data. By default, the freq will be inferred automatically.<br>See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas‚Äô available frequencies</a>.</td>
</tr>
<tr class="odd">
<td>id_col</td>
<td>str</td>
<td>unique_id</td>
<td>Column that identifies each serie.</td>
</tr>
<tr class="even">
<td>time_col</td>
<td>str</td>
<td>ds</td>
<td>Column that identifies each timestep, its values can be timestamps or integers.</td>
</tr>
<tr class="odd">
<td>target_col</td>
<td>str</td>
<td>y</td>
<td>Column that contains the target.</td>
</tr>
<tr class="even">
<td>level</td>
<td>Union</td>
<td>99</td>
<td>Confidence level between 0 and 100 for detecting the anomalies.</td>
</tr>
<tr class="odd">
<td>validate_token</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>pandas.DataFrame</strong></td>
<td></td>
<td><strong>DataFrame with anomalies flagged with 1 detected by TimeGPT.</strong></td>
</tr>
</tbody>
</table>
<p>The detect_anomalies method is designed to process a dataframe containing series and subsequently label each observation based on its anomalous nature. When fed a dataframe, the method evaluates each observation against its context within the series, using statistical measures to determine its likelihood of being an anomaly. By default, the method identifies anomalies based on a 99 percent prediction interval. Observations that fall outside this interval are considered anomalies. The resultant dataframe will feature an added label, ‚Äúanomaly‚Äù, that is set to 1 for anomalous observations and 0 otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pm_df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/Nixtla/transfer-learning-time-series/main/datasets/peyton_manning.csv'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> timegpt.detect_anomalies(pm_df, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Anomaly Detector Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">anomaly</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2008-01-10</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2008-01-11</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2008-01-12</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2008-01-13</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2008-01-14</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> pm_df.merge(timegpt_anomalies_df, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df[<span class="st">'timestamp'</span>] <span class="op">=</span> pd.to_datetime(timegpt_anomalies_df[<span class="st">'timestamp'</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> timegpt_anomalies_df.set_index(<span class="st">'timestamp'</span>)[<span class="st">'value'</span>].plot.line(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight anomalies with red color</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>anomalies <span class="op">=</span> timegpt_anomalies_df.query(<span class="st">'anomaly == 1'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>anomalies.plot.scatter(x<span class="op">=</span><span class="st">'timestamp'</span>, y<span class="op">=</span><span class="st">'value'</span>, c<span class="op">=</span><span class="st">'red'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Anomalies'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>While the default behavior of the detect_anomalies method is to operate using a 99 percent prediction interval, users have the flexibility to adjust this threshold to their requirements. This is achieved by modifying the <code>level</code> argument. Decreasing the value of the level argument will result in a broader prediction interval, subsequently identifying more observations as anomalies. See the next example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> timegpt.detect_anomalies(pm_df, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>, freq<span class="op">=</span><span class="st">'D'</span>, level<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> pm_df.merge(timegpt_anomalies_df, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df[<span class="st">'timestamp'</span>] <span class="op">=</span> pd.to_datetime(timegpt_anomalies_df[<span class="st">'timestamp'</span>])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> timegpt_anomalies_df.set_index(<span class="st">'timestamp'</span>)[<span class="st">'value'</span>].plot.line(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight anomalies with red color</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>anomalies <span class="op">=</span> timegpt_anomalies_df.query(<span class="st">'anomaly == 1'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>anomalies.plot.scatter(x<span class="op">=</span><span class="st">'timestamp'</span>, y<span class="op">=</span><span class="st">'value'</span>, c<span class="op">=</span><span class="st">'red'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Anomalies'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>ax.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Anomaly Detector Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-17-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Conversely, increasing the value will tighten the prediction interval, detecting fewer anomalies. This customization allows users to calibrate the sensitivity of the method to align with their specific use case, ensuring the most relevant and actionable insights are derived from the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> timegpt.detect_anomalies(pm_df, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>, freq<span class="op">=</span><span class="st">'D'</span>, level<span class="op">=</span><span class="fl">99.99</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df <span class="op">=</span> pm_df.merge(timegpt_anomalies_df, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>timegpt_anomalies_df[<span class="st">'timestamp'</span>] <span class="op">=</span> pd.to_datetime(timegpt_anomalies_df[<span class="st">'timestamp'</span>])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> timegpt_anomalies_df.set_index(<span class="st">'timestamp'</span>)[<span class="st">'value'</span>].plot.line(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight anomalies with red color</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>anomalies <span class="op">=</span> timegpt_anomalies_df.query(<span class="st">'anomaly == 1'</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>anomalies.plot.scatter(x<span class="op">=</span><span class="st">'timestamp'</span>, y<span class="op">=</span><span class="st">'value'</span>, c<span class="op">=</span><span class="st">'red'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Anomalies'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Anomaly Detector Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.legend.Legend&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-18-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="historical-forecast" class="level3">
<h3 class="anchored" data-anchor-id="historical-forecast">Historical forecast</h3>
<p>Our time series model offers a powerful feature that allows users to retrieve historical forecasts alongside the prospective predictions. This functionality is accessible through the forecast method by setting the add_history=True argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_with_history_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">12</span>, time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    add_history<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
INFO:__main__:Calling Historical Forecast Endpoint...</code></pre>
</div>
</div>
<p>When <code>add_history</code> is set to True, the output DataFrame will include not only the future forecasts determined by the h argument, but also the historical predictions. This consolidated view of past and future predictions can be invaluable for understanding the model‚Äôs behavior and for evaluating its performance over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_with_history_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1951-01-01</td>
<td>135.483673</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1951-02-01</td>
<td>144.442398</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1951-03-01</td>
<td>157.191910</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1951-04-01</td>
<td>148.769363</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1951-05-01</td>
<td>140.472946</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let‚Äôs plot the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df.merge(timegpt_fcst_with_history_df, how<span class="op">=</span><span class="st">'outer'</span>).set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Please note, however, that the initial values of the series are not included in these historical forecasts. This is because our model, <code>TimeGPT</code>, requires a certain number of initial observations to generate reliable forecasts. Therefore, while interpreting the output, it‚Äôs important to be aware that the first few observations serve as the basis for the model‚Äôs predictions and are not themselves predicted values.</p>
</section>
<section id="prediction-intervals" class="level3">
<h3 class="anchored" data-anchor-id="prediction-intervals">Prediction Intervals</h3>
<p>Prediction intervals provide a measure of the uncertainty in the forecasted values. In time series forecasting, a prediction interval gives an estimated range within which a future observation will fall, based on the level of confidence or uncertainty you set. This level of uncertainty is crucial for making informed decisions, risk assessments, and planning.</p>
<p>For instance, a 95% prediction interval means that 95 out of 100 times, the actual future value will fall within the estimated range. Therefore, a wider interval indicates greater uncertainty about the forecast, while a narrower interval suggests higher confidence.</p>
<p>When using TimeGPT for time series forecasting, you have the option to set the level of prediction intervals according to your requirements. TimeGPT uses conformal prediction to calibrate the intervals.</p>
<p>Here‚Äôs how you could do it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_pred_int_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">12</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>, <span class="fl">99.7</span>], </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_pred_int_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-99.7</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-99.7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1961-01-01</td>
<td>437.837921</td>
<td>415.826453</td>
<td>423.783707</td>
<td>431.987061</td>
<td>443.688782</td>
<td>451.892136</td>
<td>459.849389</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-02-01</td>
<td>426.062714</td>
<td>402.833523</td>
<td>407.694061</td>
<td>412.704926</td>
<td>439.420502</td>
<td>444.431366</td>
<td>449.291904</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1961-03-01</td>
<td>463.116547</td>
<td>423.434062</td>
<td>430.316862</td>
<td>437.412534</td>
<td>488.820560</td>
<td>495.916231</td>
<td>502.799032</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1961-04-01</td>
<td>478.244507</td>
<td>444.885193</td>
<td>446.776764</td>
<td>448.726837</td>
<td>507.762177</td>
<td>509.712250</td>
<td>511.603821</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1961-05-01</td>
<td>505.646484</td>
<td>465.736694</td>
<td>471.976787</td>
<td>478.409872</td>
<td>532.883096</td>
<td>539.316182</td>
<td>545.556275</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>history_with_fcst_df <span class="op">=</span> pd.concat([df, timegpt_fcst_pred_int_df])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> history_with_fcst_df[[<span class="st">'timestamp'</span>, <span class="st">'value'</span>, <span class="st">'TimeGPT'</span>]].set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, alpha <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">80</span>, <span class="dv">90</span>, <span class="fl">99.7</span>], [<span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>]):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="st">'timestamp'</span>], </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-lo-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-hi-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'orange'</span>, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span>alpha,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'TimeGPT-level-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">]'</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It‚Äôs essential to note that the choice of prediction interval level depends on your specific use case. For high-stakes predictions, you might want a wider interval to account for more uncertainty. For less critical forecasts, a narrower interval might be acceptable.</p>
<section id="historical-forecast-1" class="level4">
<h4 class="anchored" data-anchor-id="historical-forecast-1">Historical Forecast</h4>
<p>You can also compute prediction intervals for historical forecasts adding the <code>add_history=True</code> parameter as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_pred_int_historical_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">12</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>, <span class="fl">99.7</span>], </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    add_history<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_pred_int_historical_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
INFO:__main__:Calling Historical Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">timestamp</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-99.7</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-99.7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1951-01-01</td>
<td>135.483673</td>
<td>111.937768</td>
<td>105.262831</td>
<td>80.957520</td>
<td>159.029579</td>
<td>165.704516</td>
<td>190.009826</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1951-02-01</td>
<td>144.442398</td>
<td>120.896493</td>
<td>114.221556</td>
<td>89.916245</td>
<td>167.988304</td>
<td>174.663241</td>
<td>198.968551</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1951-03-01</td>
<td>157.191910</td>
<td>133.646004</td>
<td>126.971067</td>
<td>102.665757</td>
<td>180.737815</td>
<td>187.412752</td>
<td>211.718063</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1951-04-01</td>
<td>148.769363</td>
<td>125.223458</td>
<td>118.548521</td>
<td>94.243210</td>
<td>172.315269</td>
<td>178.990206</td>
<td>203.295516</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1951-05-01</td>
<td>140.472946</td>
<td>116.927041</td>
<td>110.252104</td>
<td>85.946793</td>
<td>164.018852</td>
<td>170.693789</td>
<td>194.999099</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>history_with_fcst_df <span class="op">=</span> df.merge(timegpt_fcst_pred_int_historical_df, how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> history_with_fcst_df[[<span class="st">'timestamp'</span>, <span class="st">'value'</span>, <span class="st">'TimeGPT'</span>]].set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, alpha <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">80</span>, <span class="dv">90</span>, <span class="fl">99.7</span>], [<span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>]):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="st">'timestamp'</span>], </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-lo-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-hi-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'orange'</span>, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span>alpha,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'TimeGPT-level-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">]'</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="finetuning" class="level3">
<h3 class="anchored" data-anchor-id="finetuning">Finetuning</h3>
<p>Fine-tuning is a process of further training a pre-existing model (like TimeGPT) on a specific task or dataset. This allows you to leverage the general language understanding capabilities of the pre-trained model and adapt it to your specific use case.</p>
<p>In TimeGPT, you can use the <code>finetune_steps</code> argument to specify the number of additional training steps the model should undergo on your time series data. This helps in refining the model‚Äôs understanding and prediction of your data patterns.</p>
<p>Here‚Äôs an example of how to fine-tune TimeGPT:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_finetune_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">12</span>, finetune_steps<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'timestamp'</span>, target_col<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, timegpt_fcst_finetune_df]).set_index(<span class="st">'timestamp'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='timestamp'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-28-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>In this code, <code>finetune_steps: 10</code> means the model will go through 10 iterations of training on your time series data.</p>
<p>Keep in mind that fine-tuning can be a bit of trial and error. You might need to adjust the number of <code>finetune_steps</code> based on your specific needs and the complexity of your data. It‚Äôs recommended to monitor the model‚Äôs performance during fine-tuning and adjust as needed. Be aware that more <code>finetune_steps</code> may lead to longer training times and could potentially lead to overfitting if not managed properly.</p>
<p>Remember, fine-tuning is a powerful feature, but it should be used thoughtfully and carefully.</p>
</section>
<section id="multiple-series" class="level3">
<h3 class="anchored" data-anchor-id="multiple-series">Multiple Series</h3>
<p>TimeGPT provides a robust solution for multi-series forecasting, which involves analyzing multiple data series concurrently, rather than a single one. The tool can be fine-tuned using a broad collection of series, enabling you to tailor the model to suit your specific needs or tasks.</p>
<p>The following dataset contains prices of different electricity markets. Let see how can we forecast them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/Nixtla/transfer-learning-time-series/main/datasets/electricity-short.csv'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-01 00:00:00</td>
<td>72.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-01 01:00:00</td>
<td>65.80</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-01 02:00:00</td>
<td>59.99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-01 03:00:00</td>
<td>50.69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-01 04:00:00</td>
<td>52.58</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let‚Äôs plot this series using <a href="https://github.com/Nixtla/statsforecast"><code>StatsForecast</code></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast <span class="im">as</span> sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sf.plot(df, engine<span class="op">=</span><span class="st">'matplotlib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We just have to pass the dataframe to create forecasts for all the time series at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_multiseries_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">24</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>])</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_multiseries_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-31 00:00:00</td>
<td>46.151176</td>
<td>36.660478</td>
<td>38.337019</td>
<td>53.965334</td>
<td>55.641875</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-31 01:00:00</td>
<td>42.426601</td>
<td>31.602235</td>
<td>33.976728</td>
<td>50.876475</td>
<td>53.250968</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-31 02:00:00</td>
<td>40.242889</td>
<td>30.439970</td>
<td>33.634985</td>
<td>46.850794</td>
<td>50.045809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-31 03:00:00</td>
<td>38.265339</td>
<td>26.841481</td>
<td>31.022093</td>
<td>45.508585</td>
<td>49.689197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-31 04:00:00</td>
<td>36.618801</td>
<td>18.541384</td>
<td>27.981346</td>
<td>45.256256</td>
<td>54.696218</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sf.plot(df, timegpt_fcst_multiseries_df, max_insample_length<span class="op">=</span><span class="dv">365</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], engine<span class="op">=</span><span class="st">'matplotlib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="historical-forecast-2" class="level4">
<h4 class="anchored" data-anchor-id="historical-forecast-2">Historical forecast</h4>
<p>You can also compute prediction intervals for historical forecasts adding the <code>add_history=True</code> parameter as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_multiseries_with_history_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, h<span class="op">=</span><span class="dv">24</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], add_history<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_multiseries_with_history_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
INFO:__main__:Calling Historical Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-06 00:00:00</td>
<td>55.756325</td>
<td>42.066469</td>
<td>38.185585</td>
<td>69.446180</td>
<td>73.327064</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-06 01:00:00</td>
<td>52.820198</td>
<td>39.130342</td>
<td>35.249458</td>
<td>66.510054</td>
<td>70.390938</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-06 02:00:00</td>
<td>46.851070</td>
<td>33.161215</td>
<td>29.280331</td>
<td>60.540926</td>
<td>64.421810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-06 03:00:00</td>
<td>50.640877</td>
<td>36.951021</td>
<td>33.070137</td>
<td>64.330732</td>
<td>68.211616</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-06 04:00:00</td>
<td>52.420403</td>
<td>38.730547</td>
<td>34.849663</td>
<td>66.110258</td>
<td>69.991142</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sf.plot(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    df, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    timegpt_fcst_multiseries_with_history_df.groupby(<span class="st">'unique_id'</span>).tail(<span class="dv">365</span> <span class="op">+</span> <span class="dv">24</span>), </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    max_insample_length<span class="op">=</span><span class="dv">365</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], engine<span class="op">=</span><span class="st">'matplotlib'</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/fedex/miniconda3/envs/nixtlats/lib/python3.10/site-packages/statsforecast/core.py:1527: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  forecasts_df["unique_id"] = forecasts_df["unique_id"].astype(</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-35-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="exogenous-variables" class="level3">
<h3 class="anchored" data-anchor-id="exogenous-variables">Exogenous variables</h3>
<p>Exogenous variables or external factors are crucial in time series forecasting as they provide additional information that might influence the prediction. These variables could include holiday markers, marketing spending, weather data, or any other external data that correlate with the time series data you are forecasting.</p>
<p>For example, if you‚Äôre forecasting ice cream sales, temperature data could serve as a useful exogenous variable. On hotter days, ice cream sales may increase.</p>
<p>To incorporate exogenous variables in TimeGPT, you‚Äôll need to pair each point in your time series data with the corresponding external data.</p>
<p>Let‚Äôs see an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/Nixtla/transfer-learning-time-series/main/datasets/electricity-short-with-ex-vars.csv'</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Exogenous1</th>
<th data-quarto-table-cell-role="th">Exogenous2</th>
<th data-quarto-table-cell-role="th">day_0</th>
<th data-quarto-table-cell-role="th">day_1</th>
<th data-quarto-table-cell-role="th">day_2</th>
<th data-quarto-table-cell-role="th">day_3</th>
<th data-quarto-table-cell-role="th">day_4</th>
<th data-quarto-table-cell-role="th">day_5</th>
<th data-quarto-table-cell-role="th">day_6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-01 00:00:00</td>
<td>72.00</td>
<td>61507.0</td>
<td>71066.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-01 01:00:00</td>
<td>65.80</td>
<td>59528.0</td>
<td>67311.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-01 02:00:00</td>
<td>59.99</td>
<td>58812.0</td>
<td>67470.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-01 03:00:00</td>
<td>50.69</td>
<td>57676.0</td>
<td>64529.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-01 04:00:00</td>
<td>52.58</td>
<td>56804.0</td>
<td>62773.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To produce forecasts we have to add the future values of the exogenous variables. Let‚Äôs read this dataset. In this case we want to predict 24 steps ahead, therefore each unique id will have 24 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>future_ex_vars_df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/Nixtla/transfer-learning-time-series/main/datasets/electricity-short-future-ex-vars.csv'</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>future_ex_vars_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">Exogenous1</th>
<th data-quarto-table-cell-role="th">Exogenous2</th>
<th data-quarto-table-cell-role="th">day_0</th>
<th data-quarto-table-cell-role="th">day_1</th>
<th data-quarto-table-cell-role="th">day_2</th>
<th data-quarto-table-cell-role="th">day_3</th>
<th data-quarto-table-cell-role="th">day_4</th>
<th data-quarto-table-cell-role="th">day_5</th>
<th data-quarto-table-cell-role="th">day_6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-31 00:00:00</td>
<td>64108.0</td>
<td>70318.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-31 01:00:00</td>
<td>62492.0</td>
<td>67898.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-31 02:00:00</td>
<td>61571.0</td>
<td>68379.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-31 03:00:00</td>
<td>60381.0</td>
<td>64972.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-31 04:00:00</td>
<td>60298.0</td>
<td>62900.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let‚Äôs call the <code>forecast</code> method, adding this information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_ex_vars_df <span class="op">=</span> timegpt.forecast(df<span class="op">=</span>df, X_df<span class="op">=</span>future_ex_vars_df, h<span class="op">=</span><span class="dv">24</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>])</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>timegpt_fcst_ex_vars_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-90</th>
<th data-quarto-table-cell-role="th">TimeGPT-lo-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-80</th>
<th data-quarto-table-cell-role="th">TimeGPT-hi-90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-31 00:00:00</td>
<td>38.861762</td>
<td>33.821073</td>
<td>34.368669</td>
<td>43.354854</td>
<td>43.902450</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-31 01:00:00</td>
<td>35.382102</td>
<td>30.014594</td>
<td>31.493322</td>
<td>39.270882</td>
<td>40.749610</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-31 02:00:00</td>
<td>33.811425</td>
<td>26.658821</td>
<td>28.543087</td>
<td>39.079764</td>
<td>40.964029</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-31 03:00:00</td>
<td>31.707475</td>
<td>24.896205</td>
<td>26.818795</td>
<td>36.596155</td>
<td>38.518745</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-31 04:00:00</td>
<td>30.316475</td>
<td>21.125143</td>
<td>24.432148</td>
<td>36.200801</td>
<td>39.507807</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>sf.plot(df[[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>, <span class="st">'y'</span>]], timegpt_fcst_ex_vars_df, max_insample_length<span class="op">=</span><span class="dv">365</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], engine<span class="op">=</span><span class="st">'matplotlib'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/fedex/miniconda3/envs/nixtlats/lib/python3.10/site-packages/statsforecast/core.py:1514: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df["unique_id"] = df["unique_id"].astype(uid_dtype)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-39-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'ds'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'ds'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'ds'</span>).groupby(<span class="st">'unique_id'</span>).resample(<span class="st">'H'</span>).bfill().drop(columns<span class="op">=</span><span class="st">'unique_id'</span>).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">Exogenous1</th>
<th data-quarto-table-cell-role="th">Exogenous2</th>
<th data-quarto-table-cell-role="th">day_0</th>
<th data-quarto-table-cell-role="th">day_1</th>
<th data-quarto-table-cell-role="th">day_2</th>
<th data-quarto-table-cell-role="th">day_3</th>
<th data-quarto-table-cell-role="th">day_4</th>
<th data-quarto-table-cell-role="th">day_5</th>
<th data-quarto-table-cell-role="th">day_6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BE</td>
<td>2016-12-01 00:00:00</td>
<td>72.000000</td>
<td>61507.0</td>
<td>71066.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BE</td>
<td>2016-12-01 01:00:00</td>
<td>65.800000</td>
<td>59528.0</td>
<td>67311.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BE</td>
<td>2016-12-01 02:00:00</td>
<td>59.990000</td>
<td>58812.0</td>
<td>67470.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BE</td>
<td>2016-12-01 03:00:00</td>
<td>50.690000</td>
<td>57676.0</td>
<td>64529.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BE</td>
<td>2016-12-01 04:00:00</td>
<td>52.580000</td>
<td>56804.0</td>
<td>62773.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3595</td>
<td>PJM</td>
<td>2018-12-23 19:00:00</td>
<td>32.461970</td>
<td>98288.0</td>
<td>11711.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3596</td>
<td>PJM</td>
<td>2018-12-23 20:00:00</td>
<td>32.052179</td>
<td>97194.0</td>
<td>11637.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3597</td>
<td>PJM</td>
<td>2018-12-23 21:00:00</td>
<td>27.632347</td>
<td>94319.0</td>
<td>11433.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3598</td>
<td>PJM</td>
<td>2018-12-23 22:00:00</td>
<td>24.746053</td>
<td>90106.0</td>
<td>11108.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3599</td>
<td>PJM</td>
<td>2018-12-23 23:00:00</td>
<td>23.333499</td>
<td>85547.0</td>
<td>10581.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>3600 rows √ó 12 columns</p>
</div>
</div>
</div>
<p>We also can get the importance of the features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>timegpt.weights_x.plot.barh(x<span class="op">=</span><span class="st">'features'</span>, y<span class="op">=</span><span class="st">'weights'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: ylabel='features'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="forecasting-time-series-with-irregular-timestamps" class="level3">
<h3 class="anchored" data-anchor-id="forecasting-time-series-with-irregular-timestamps">Forecasting Time Series with Irregular Timestamps</h3>
<p>When working with time series data, the frequency of the timestamps is a crucial factor that can significantly impact the forecasting results. Regular frequencies like daily, weekly, or monthly are straightforward to handle. However, irregular frequencies like business days, which exclude weekends, can be challenging for time series forecasting methods.</p>
<p>Our forecast method is equipped to handle this kind of irregular time series data, as long as you specify the frequency of the series. For example, in the case of business days, the frequency should be passed as ‚ÄòB‚Äô. Without this, the method might fail to automatically detect the frequency, especially when the timestamps are irregular.</p>
<p>The first step is to fetch your time series data. The data must include timestamps and the associated values. For instance, you might be working with stock prices, and your data could look something like the following. In this example we use <a href="https://docs.openbb.co/sdk">OpenBB</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openbb_terminal.sdk <span class="im">import</span> openbb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>pltr_df <span class="op">=</span> openbb.stocks.load(<span class="st">'PLTR'</span>, start_date<span class="op">=</span><span class="st">'2020-09-30'</span>).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Loading Daily data for PLTR with starting period 2020-09-30.
</pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pltr_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Adj Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Dividends</th>
<th data-quarto-table-cell-role="th">Stock Splits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-09-30</td>
<td>10.00</td>
<td>11.41</td>
<td>9.11</td>
<td>9.50</td>
<td>9.50</td>
<td>338584400</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-10-01</td>
<td>9.69</td>
<td>10.10</td>
<td>9.23</td>
<td>9.46</td>
<td>9.46</td>
<td>124297600</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-10-02</td>
<td>9.06</td>
<td>9.28</td>
<td>8.94</td>
<td>9.20</td>
<td>9.20</td>
<td>55018300</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2020-10-05</td>
<td>9.43</td>
<td>9.49</td>
<td>8.92</td>
<td>9.03</td>
<td>9.03</td>
<td>36316900</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2020-10-06</td>
<td>9.04</td>
<td>10.18</td>
<td>8.90</td>
<td>9.90</td>
<td>9.90</td>
<td>90864000</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let‚Äôs see that this dataset has irregular timestamps. The dayofweek attribute from pandas‚Äô DatetimeIndex returns the day of the week with Monday=0, Sunday=6. So, checking if dayofweek &gt; 4 is essentially checking if the date falls on a Saturday (5) or Sunday (6), which are typically non-business days (weekends).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(pltr_df[<span class="st">'date'</span>].dt.dayofweek <span class="op">&gt;</span> <span class="dv">4</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0</code></pre>
</div>
</div>
<p>As we can see the timestamp is irregular. Let‚Äôs inspect the <code>Close</code> series.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>pltr_df.set_index(<span class="st">'date'</span>)[<span class="st">'Close'</span>].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-47-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>To forecast this data, you can use our <code>forecast</code> method. Importantly, remember to specify the frequency of the data using the <code>freq</code> argument. In this case, it would be ‚ÄòB‚Äô for business days. We also need to define the <code>time_col</code> to select the index of the series (by default is <code>ds</code>), and the <code>target_col</code> to forecast our target variable, in this case we will forecast <code>Close</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>pltr_df, h<span class="op">=</span><span class="dv">14</span>, freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'date'</span>, target_col<span class="op">=</span><span class="st">'Close'</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-08-28</td>
<td>14.726294</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-08-29</td>
<td>14.632822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-08-30</td>
<td>14.723761</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-08-31</td>
<td>14.722337</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-09-01</td>
<td>14.803411</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Remember, for business days, the frequency is ‚ÄòB‚Äô. For other frequencies, you can refer to the pandas offset aliases documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases.</p>
<p>By specifying the frequency, you‚Äôre helping the forecast method better understand the pattern in your data, resulting in more accurate and reliable forecasts.</p>
<p>Let‚Äôs plot the forecasts generated by <code>TimeGPT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    pltr_df[[<span class="st">'date'</span>, <span class="st">'Close'</span>]].tail(<span class="dv">90</span>),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    fcst_pltr_df</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>]).set_index(<span class="st">'date'</span>).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-50-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>You can also add uncertainty quantification to your forecasts using the <code>level</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_levels_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>pltr_df, h<span class="op">=</span><span class="dv">42</span>, freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'date'</span>, target_col<span class="op">=</span><span class="st">'Close'</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    add_history<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>[<span class="fl">40.66</span>, <span class="dv">90</span>]</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.
INFO:__main__:Calling Historical Forecast Endpoint...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>history_with_fcst_df <span class="op">=</span> fcst_pltr_levels_df.merge(pltr_df.assign(date<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">'date'</span>].astype(<span class="bu">str</span>)), how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> history_with_fcst_df[[<span class="st">'date'</span>, <span class="st">'Close'</span>, <span class="st">'TimeGPT'</span>]].set_index(<span class="st">'date'</span>).plot(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, alpha <span class="kw">in</span> <span class="bu">zip</span>([<span class="fl">40.66</span>, <span class="dv">90</span>], [<span class="fl">0.4</span>, <span class="fl">0.2</span>]):</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="st">'date'</span>], </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-lo-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        history_with_fcst_df[<span class="ss">f'TimeGPT-hi-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">'</span>], </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'orange'</span>, </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span>alpha,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'TimeGPT-level-</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">]'</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>If you want to forecast another just change the <code>target_col</code> parameter. Let‚Äôs forecast <code>Volume</code> now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>pltr_df, h<span class="op">=</span><span class="dv">14</span>, freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'date'</span>, target_col<span class="op">=</span><span class="st">'Volume'</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    pltr_df[[<span class="st">'date'</span>, <span class="st">'Volume'</span>]].tail(<span class="dv">90</span>),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    fcst_pltr_df</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>]).set_index(<span class="st">'date'</span>).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-53-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>But what if we want to predict all the time series at once? We can do that reshaping our dataframe. Currently, the dataframe is in wide format (each series is a column), but we need to have them in long format (stacked one each other). We can do it with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>pltr_long_df <span class="op">=</span> pd.melt(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    pltr_df, </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'date'</span>],</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'series_id'</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>pltr_long_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">series_id</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2020-09-30</td>
<td>Open</td>
<td>10.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2020-10-01</td>
<td>Open</td>
<td>9.69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2020-10-02</td>
<td>Open</td>
<td>9.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2020-10-05</td>
<td>Open</td>
<td>9.43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2020-10-06</td>
<td>Open</td>
<td>9.04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Then we just simply call the <code>forecast</code> method specifying the <code>id_col</code> parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_long_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>pltr_long_df, h<span class="op">=</span><span class="dv">14</span>, freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    id_col<span class="op">=</span><span class="st">'series_id'</span>, time_col<span class="op">=</span><span class="st">'date'</span>, target_col<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_long_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">series_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Adj Close</td>
<td>2023-08-28</td>
<td>14.726294</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adj Close</td>
<td>2023-08-29</td>
<td>14.632822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adj Close</td>
<td>2023-08-30</td>
<td>14.723761</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Adj Close</td>
<td>2023-08-31</td>
<td>14.722338</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Adj Close</td>
<td>2023-09-01</td>
<td>14.803411</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Then we can forecast the <code>Open</code> series:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    pltr_long_df.query(<span class="st">'series_id == "Open"'</span>).tail(<span class="dv">90</span>),</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    fcst_pltr_long_df.query(<span class="st">'series_id == "Open"'</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>]).set_index(<span class="st">'date'</span>).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-58-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="adding-extra-information" class="level4">
<h4 class="anchored" data-anchor-id="adding-extra-information">Adding extra information</h4>
<p>In time series forecasting, the variables that we predict are often influenced not just by their past values, but also by other factors or variables. These external variables, known as exogenous variables, can provide vital additional context that can significantly improve the accuracy of our forecasts. One such factor, and the focus of this tutorial, is the company‚Äôs revenue. Revenue figures can provide a key indicator of a company‚Äôs financial health and growth potential, both of which can heavily influence its stock price. That we can obtain from openbb.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>revenue_pltr <span class="op">=</span> openbb.stocks.fa.income(<span class="st">'PLTR'</span>, quarterly<span class="op">=</span><span class="va">True</span>, source<span class="op">=</span><span class="st">'AlphaVantage'</span>).loc[<span class="st">'totalRevenue'</span>].reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>revenue_pltr.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fiscalDateEnding</th>
<th data-quarto-table-cell-role="th">totalRevenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2022-06-30</td>
<td>473010000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>2022-09-30</td>
<td>477880000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>2022-12-31</td>
<td>508624000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>2023-03-31</td>
<td>525186000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>2023-06-30</td>
<td>533317000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The first thing we observe in our dataset is that we have information available only up until the end of the first quarter of 2023. Our data is represented in a quarterly frequency, and our goal is to leverage this information to forecast the daily stock prices for the next 14 days beyond this date.</p>
<p>However, to accurately compute such a forecast that includes the revenue as an exogenous variable, we need to have an understanding of the future values of the revenue. This is critical because these future revenue values can significantly influence the stock price.</p>
<p>Since we‚Äôre aiming to predict 14 daily stock prices, we only need to forecast the revenue for the upcoming quarter. This approach allows us to create a cohesive forecasting pipeline where the output of one forecast (revenue) is used as an input to another (stock price), thereby leveraging all available information for the most accurate predictions possible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_revenue <span class="op">=</span> timegpt.forecast(revenue_pltr, h<span class="op">=</span><span class="dv">1</span>, time_col<span class="op">=</span><span class="st">'fiscalDateEnding'</span>, target_col<span class="op">=</span><span class="st">'totalRevenue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_revenue.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fiscalDateEnding</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-09-30</td>
<td>547264448</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Continuing from where we left off, the next crucial step in our forecasting pipeline is to adjust the frequency of our data to match the stock prices‚Äô frequency, which is represented on a business day basis. To accomplish this, we need to resample both the historical and future forecasted revenue data.</p>
<p>We can achieve this using the following code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>revenue_pltr[<span class="st">'fiscalDateEnding'</span>] <span class="op">=</span> pd.to_datetime(revenue_pltr[<span class="st">'fiscalDateEnding'</span>])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>revenue_pltr <span class="op">=</span> revenue_pltr.set_index(<span class="st">'fiscalDateEnding'</span>).resample(<span class="st">'B'</span>).ffill().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>IMPORTANT NOTE</strong>: It‚Äôs crucial to highlight that in this process, we are assigning the same revenue value to all days within the given quarter. This simplification is necessary due to the disparity in granularity between quarterly revenue data and daily stock price data. However, it‚Äôs vital to treat this assumption with caution in practical applications. The impact of quarterly revenue figures on daily stock prices can vary significantly within the quarter based on a range of factors, including changing market expectations, other financial news, and events. In this tutorial, we use this assumption to illustrate the process of incorporating exogenous variables into our forecasting model, but in real-world scenarios, a more nuanced approach may be needed, depending on the available data and the specific use case.</p>
<p>Then we can create the full historic dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>pltr_revenue_df <span class="op">=</span> pltr_df.merge(revenue_pltr.rename(columns<span class="op">=</span>{<span class="st">'fiscalDateEnding'</span>: <span class="st">'date'</span>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>pltr_revenue_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">Adj Close</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">Dividends</th>
<th data-quarto-table-cell-role="th">Stock Splits</th>
<th data-quarto-table-cell-role="th">totalRevenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-03-31</td>
<td>22.500000</td>
<td>23.850000</td>
<td>22.379999</td>
<td>23.290001</td>
<td>23.290001</td>
<td>61458500</td>
<td>0.0</td>
<td>0.0</td>
<td>341234000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-04-01</td>
<td>23.950001</td>
<td>23.950001</td>
<td>22.730000</td>
<td>23.070000</td>
<td>23.070000</td>
<td>51788800</td>
<td>0.0</td>
<td>0.0</td>
<td>341234000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-04-05</td>
<td>23.780001</td>
<td>24.450001</td>
<td>23.340000</td>
<td>23.440001</td>
<td>23.440001</td>
<td>65374300</td>
<td>0.0</td>
<td>0.0</td>
<td>341234000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-04-06</td>
<td>23.549999</td>
<td>23.610001</td>
<td>22.830000</td>
<td>23.270000</td>
<td>23.270000</td>
<td>41933500</td>
<td>0.0</td>
<td>0.0</td>
<td>341234000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-04-07</td>
<td>23.000000</td>
<td>23.549999</td>
<td>22.809999</td>
<td>22.900000</td>
<td>22.900000</td>
<td>32766200</td>
<td>0.0</td>
<td>0.0</td>
<td>341234000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To calculate the dataframe of the future revenue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>future_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: pd.date_range(pltr_revenue_df[<span class="st">'date'</span>].iloc[<span class="op">-</span><span class="dv">1</span>], periods<span class="op">=</span>horizon <span class="op">+</span> <span class="dv">1</span>, freq<span class="op">=</span><span class="st">'B'</span>)[<span class="op">-</span>horizon:],</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'totalRevenue'</span>: np.repeat(fcst_pltr_revenue.iloc[<span class="dv">0</span>][<span class="st">'TimeGPT'</span>], horizon)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>future_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">totalRevenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-07-03</td>
<td>547264448</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-07-04</td>
<td>547264448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-07-05</td>
<td>547264448</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-07-06</td>
<td>547264448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-07-07</td>
<td>547264448</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And then we can pass the future revenue in the <code>forecast</code> method using the <code>X_df</code> argument. Since the revenue is in the historic dataframe, that information will be used in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    pltr_revenue_df, h<span class="op">=</span>horizon, </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'date'</span>, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    target_col<span class="op">=</span><span class="st">'Close'</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    X_df<span class="op">=</span>future_df,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    pltr_revenue_df[[<span class="st">'date'</span>, <span class="st">'Close'</span>]].tail(<span class="dv">90</span>),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    fcst_pltr_df</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>]).set_index(<span class="st">'date'</span>).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-71-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>We can also see the importance of the revenue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>timegpt.weights_x.plot.barh(x<span class="op">=</span><span class="st">'features'</span>, y<span class="op">=</span><span class="st">'weights'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: ylabel='features'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-72-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="calendar-variables" class="level3">
<h3 class="anchored" data-anchor-id="calendar-variables">Calendar variables</h3>
<p>When working with time series data, date features such as day, year, month, and others can have a significant impact on the target variable. For instance, retail sales might be influenced by the day of the week or the month of the year due to weekends or holiday shopping seasons.</p>
<p>In the provided code snippet, the date_features parameter is used to incorporate these temporal influences into the forecasting model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>fcst_pltr_calendar_df <span class="op">=</span> timegpt.forecast(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>pltr_df.tail(<span class="dv">2</span> <span class="op">*</span> <span class="dv">14</span>), h<span class="op">=</span><span class="dv">14</span>, freq<span class="op">=</span><span class="st">'B'</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    time_col<span class="op">=</span><span class="st">'date'</span>, target_col<span class="op">=</span><span class="st">'Close'</span>,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    date_features<span class="op">=</span><span class="va">True</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>fcst_pltr_calendar_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Validating inputs...
INFO:__main__:Preprocessing dataframes...
INFO:__main__:Calling Forecast Endpoint...
WARNING:__main__:The specified horizon "h" exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">TimeGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-08-28</td>
<td>15.879999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-08-29</td>
<td>16.511786</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-08-30</td>
<td>16.009749</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-08-31</td>
<td>17.660001</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-09-01</td>
<td>20.544631</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    pltr_df[[<span class="st">'date'</span>, <span class="st">'Close'</span>]].tail(<span class="dv">90</span>),</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    fcst_pltr_calendar_df</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>]).set_index(<span class="st">'date'</span>).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: xlabel='date'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>We can also plot the importance of each of the date features:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>timegpt.weights_x.plot.barh(x<span class="op">=</span><span class="st">'features'</span>, y<span class="op">=</span><span class="st">'weights'</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Axes: ylabel='features'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="timegpt_files/figure-html/cell-75-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Here‚Äôs a breakdown of how the <code>date_features</code> parameter works:</p>
<ul>
<li><strong><code>date_features</code> (bool or list of str or callable)</strong>: This parameter specifies which date attributes to consider.
<ul>
<li>If set to <code>True</code>, the model will automatically add the most common date features related to the frequency of the given dataframe (<code>df</code>). For a daily frequency, this could include features like day of the week, month, and year.</li>
<li>If provided a list of strings, it will consider those specific date attributes. For example, <code>date_features=['weekday', 'month']</code> will only add the day of the week and month as features.</li>
<li>If provided a callable, it should be a function that takes dates as input and returns the desired feature. This gives flexibility in computing custom date features.</li>
</ul></li>
<li><strong><code>date_features_to_one_hot</code> (bool or list of str)</strong>: After determining the date features, one might want to one-hot encode them, especially if they are categorical in nature (like weekdays). One-hot encoding transforms these categorical features into a binary matrix, making them more suitable for many machine learning algorithms.
<ul>
<li>If <code>date_features=True</code>, then by default, all computed date features will be one-hot encoded.</li>
<li>If provided a list of strings, only those specific date features will be one-hot encoded.</li>
</ul></li>
</ul>
<p>By leveraging the <code>date_features</code> and <code>date_features_to_one_hot</code> parameters, one can efficiently incorporate the temporal effects of date attributes into their forecasting model, potentially enhancing its accuracy and interpretability.</p>


</section>
</section>

<p>Give us a ‚≠ê&nbsp;on <a href="https://github.com/nixtla/nixtlats">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>